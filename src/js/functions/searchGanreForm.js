import { getGenresByGenresId } from './getGenresByGenresId';
import { getGenresIdByGenres } from './getGenresIdByGenres';
//import { refs } from '../list-library';

LibraryFromLocalStorage = JSON.parse(localStorage.getItem('library'));

//console.log(LibraryFromLocalStorage);

function libraryListAllGanre(array) {
  return array.flatMap(array => array.genre_ids);
}
const Ganre = getGenresByGenresId(libraryListAllGanre(LibraryFromLocalStorage));
//console.log(Ganre);

const arrayUnicalGanres = [...new Set(Ganre)];

console.log(arrayUnicalGanres);
//===============================Have array all Ganres in library======================

const root = document.documentElement;
const dropdownTitleIcon = document.querySelector('.dropdown-title-icon');
const dropdownTitle = document.querySelector('.dropdown-title');
const dropdownList = document.querySelector('.dropdown-list');
const mainButton = document.querySelector('.main-button');
const floatingIcon = document.querySelector('.floating-icon');

const iconsKino = {
  //  drama:
  //    'M418.813 30.625c-21.178 26.27-49.712 50.982-84.125 70.844-36.778 21.225-75.064 33.62-110.313 38.06 2.048 6.063 4.316 12.15 6.813 18.25 16.01.277 29.366-.434 36.406-1.5l9.47-1.53 8.436-1.28.22 10.186c-.17 6.172-.535 12.41-1.095 18.72l56.625 8.843c.86-.095 1.713-.15 2.563-.157 11.188-.114 21.44 7.29 24.468 18.593.657 2.448.922 4.903.845 7.313 5.972-2.075 11.753-4.305 17.28-6.72l9.595-4.188 2.313 10.22c3.483 15.308 6.028 31.385 7.375 48.062C438.29 247.836 468.438 225.71 493 197.5c-3.22-36.73-16.154-78.04-39.125-117.813-.735-1.272-1.47-2.526-2.22-3.78l-27.56 71.374c5.154.762 10.123 3.158 14.092 7.126 9.81 9.807 9.813 25.69 0 35.5-9.812 9.81-25.722 9.807-35.53 0-8.86-8.858-9.69-22.68-2.532-32.5l38.938-100.844c-6.45-9.18-13.215-17.83-20.25-25.937zM51.842 118.72c-8.46 17.373-15.76 36.198-21.187 56.436-14.108 52.617-13.96 103.682-2.812 143.438 13.3-2.605 26.442-3.96 39.312-4.03 1.855-.012 3.688.02 5.53.06 20.857.48 40.98 4.332 59.97 11.5-1.08-11.156-1.656-22.574-1.656-34.218 0-27.8 3.135-54.377 9-78.937l2.47-10.407 9.655 4.562c29.467 13.98 66.194 23.424 106.28 25.22 5.136-20.05 8.19-39.78 9.408-58.75-35.198 4.83-75.387 2.766-116.407-8.22-38.363-10.272-72.314-26.78-99.562-46.656zm230.594 82.218c-1.535 10.452-3.615 21.03-6.218 31.687 15.873-.193 31.286-1.594 46-3.97-1.056-1.84-1.895-3.822-2.47-5.968-1.455-5.432-1-10.925.938-15.78l-38.25-5.97zM105 201.375l4.156 18.22-21.594 4.905c8.75 5.174 13.353 15.703 10.594 26-3.32 12.394-16.045 19.758-28.437 16.438-12.394-3.32-19.76-16.075-16.44-28.47.676-2.517 1.756-4.82 3.126-6.874l-21.062 4.78-4.125-18.218 73.78-16.78zm388.594 22.813c-25.53 25.46-55.306 45.445-86.906 60.5.05 2.397.093 4.8.093 7.218 0 9.188-.354 18.232-1.03 27.125 16.635 1.33 32.045-1.7 45.344-9.374 25.925-14.962 40.608-45.694 42.5-85.47zm-338.844 3c-4.03 19.993-6.33 41.31-6.406 63.593l.125-.342c30.568 10.174 62.622 17.572 95.25 21.375l7.5.875.718 7.5 5.687 60.125-18.625 1.75-2.53-26.75c-4.547 1.875-9.726 2.34-14.845.968-12.393-3.32-19.76-16.042-16.438-28.436.285-1.06.647-2.08 1.063-3.063-19.535-3.727-38.736-8.592-57.406-14.53 2.69 49.62 16.154 94.04 36.094 126.656 22.366 36.588 52.13 57.78 83.968 57.78 31.838.003 61.602-21.19 83.97-57.78 19.536-31.96 32.846-75.244 35.905-123.656-15.773 4.657-31.894 8.552-48.25 11.656 1.914 4.57 2.415 9.78 1.033 14.938-3.322 12.394-16.045 19.758-28.438 16.437-.732-.195-1.43-.427-2.125-.686l-2.5 26.47-18.594-1.752 5.688-60.125.72-7.5 7.498-.875c29.245-3.407 57.995-9.717 85.657-18.312v-1.594c0-21.573-2.27-42.23-6.064-61.75C351.132 242.653 313.092 250 272.312 250c-43.59 0-83.986-8.658-117.562-22.813zm-87.5 105.968c-10.87.102-21.995 1.22-33.375 3.313 12.695 31.62 33.117 53.07 59 60 16.9 4.523 34.896 2.536 52.813-5.25-4.382-13.89-7.874-28.606-10.344-43.97-21.115-9.623-43.934-14.32-68.094-14.094zm137.5 80.22h130.813c-40.082 44.594-92.623 42.844-130.813 0z',
  //  comedia:
  //    'M460.8 11.378H210.489c-28.233 0-51.2 22.968-51.2 51.2V102.4H51.2C22.968 102.4 0 125.368 0 153.6v170.667c0 97.244 79.112 176.356 176.356 176.356 66.339 0 124.229-36.824 154.332-91.099 1.655.046 3.309.076 4.957.076C432.888 409.6 512 330.488 512 233.244V62.578c0-28.232-22.967-51.2-51.2-51.2zM318.578 324.267c0 78.421-63.801 142.222-142.222 142.222S34.133 402.688 34.133 324.267V153.6c0-9.411 7.656-17.067 17.067-17.067h250.311c9.412 0 17.067 7.656 17.067 17.067v170.667zm159.289-91.023c0 75.203-58.673 136.949-132.646 141.892a175.803 175.803 0 0 0 7.49-50.87V275.04c23.035 5.403 42.345 21.588 51.519 44.252l31.641-12.807c-14.441-35.67-46.06-60.36-83.159-66.207V153.6c0-28.232-22.967-51.2-51.2-51.2h-108.09V62.578c0-9.411 7.656-17.067 17.067-17.067H460.8c9.412 0 17.067 7.656 17.067 17.067v170.666z"/><path d="M244.916 351.994c-11.37 28.083-38.283 46.228-68.56 46.228s-57.19-18.145-68.561-46.228l-31.638 12.811c16.617 41.035 55.947 67.55 100.2 67.55s83.582-26.515 100.198-67.55l-31.639-12.811z',
  //  action:
  //    'M381.694 57.191c-6.012 0-10.925 4.849-10.925 10.925v6.465H228.094v-.711c0-12.024-9.826-21.786-21.786-21.786h-86.497c-12.024 0-21.786 9.826-21.786 21.786v8.663H66.737c-3.62-14.545-16.873-25.341-32.517-25.341-6.012 0-10.925 4.849-10.925 10.925 0 6.012 4.849 10.925 10.925 10.925 6.465 0 11.83 5.236 11.83 11.83v54.238c0 6.012 4.849 10.925 10.925 10.925h4.848C34.995 185.191 8.038 232.06.151 305.563c-1.616 16.549 9.826 34.069 31.289 34.844h55.854a31.316 31.316 0 0 0 31.289-28.574c1.099-12.024 2.715-25.665 5.107-39.628 70.012-4.396 88.307-59.216 92.703-79.127 6.853-3.62 11.636-10.796 11.636-19.135v-24.63h153.535c6.012 0 10.925-4.848 10.925-10.925V68.116c.066-6.012-4.783-10.925-10.795-10.925zM98.025 104.383v29.802h-30.19v-29.802h30.19zm-1.099 205.576c-.453 4.913-4.655 8.727-9.568 8.727H31.44c-6.012 0-10.343-5.624-9.568-10.731 8.727-82.36 42.861-127.871 71.176-151.984h4.913v15.58c0 13.382 10.796 24.178 24.178 24.178-13.382 32.969-21.528 71.369-25.213 114.23zm31.031-59.928c3.232-14.481 7.37-28.638 12.541-41.568l10.667 11.119c3.814 4.008 10.796 4.719 15.451.323 4.331-4.202 4.461-11.055.323-15.451l-8.339-8.792h34.844c-5.301 17.715-20.881 49.004-65.487 54.369zm78.416-76.089h-86.562V73.934h86.562v100.008zm164.396-46.48H228.094V96.496h142.675v30.966z',
  kino: 'M430 460h30V351.327a258.217 258.217 0 0 1-30 44.817V460zM230 0C102.975 0 0 102.975 0 230s102.975 230 230 230 230-102.975 230-230S357.025 0 230 0zm0 40c30.376 0 55 24.624 55 55s-24.624 55-55 55-55-24.624-55-55 24.624-55 55-55zM46.607 188.283c0-30.376 24.624-55 55-55 30.375 0 55 24.624 55 55 0 30.375-24.625 55-55 55s-55-24.625-55-55zm104.042 205.934c-30.375 0-55-24.624-55-55s24.625-55 55-55c30.376 0 55 24.624 55 55s-24.624 55-55 55zM230 250c-11.046 0-20-8.954-20-20s8.954-20 20-20 20 8.954 20 20-8.954 20-20 20zm79.351 144.217c-30.376 0-55-24.624-55-55s24.624-55 55-55c30.375 0 55 24.624 55 55s-24.624 55-55 55zm49.042-150.934c-30.375 0-55-24.625-55-55 0-30.376 24.625-55 55-55 30.376 0 55 24.624 55 55 0 30.375-24.625 55-55 55z',
  //  youtube:
  //    'M8.051 1.999h.089c.822.003 4.987.033 6.11.335a2.01 2.01 0 0 1 1.415 1.42c.101.38.172.883.22 1.402l.01.104.022.26.008.104c.065.914.073 1.77.074 1.957v.075c-.001.194-.01 1.108-.082 2.06l-.008.105-.009.104c-.05.572-.124 1.14-.235 1.558a2.007 2.007 0 0 1-1.415 1.42c-1.16.312-5.569.334-6.18.335h-.142c-.309 0-1.587-.006-2.927-.052l-.17-.006-.087-.004-.171-.007-.171-.007c-1.11-.049-2.167-.128-2.654-.26a2.007 2.007 0 0 1-1.415-1.419c-.111-.417-.185-.986-.235-1.558L.09 9.82l-.008-.104A31.4 31.4 0 0 1 0 7.68v-.123c.002-.215.01-.958.064-1.778l.007-.103.003-.052.008-.104.022-.26.01-.104c.048-.519.119-1.023.22-1.402a2.007 2.007 0 0 1 1.415-1.42c.487-.13 1.544-.21 2.654-.26l.17-.007.172-.006.086-.003.171-.007A99.788 99.788 0 0 1 7.858 2h.193zM6.4 5.209v4.818l4.157-2.408L6.4 5.209z',
};
const kinoIcon =
  'M430 460h30V351.327a258.217 258.217 0 0 1-30 44.817V460zM230 0C102.975 0 0 102.975 0 230s102.975 230 230 230 230-102.975 230-230S357.025 0 230 0zm0 40c30.376 0 55 24.624 55 55s-24.624 55-55 55-55-24.624-55-55 24.624-55 55-55zM46.607 188.283c0-30.376 24.624-55 55-55 30.375 0 55 24.624 55 55 0 30.375-24.625 55-55 55s-55-24.625-55-55zm104.042 205.934c-30.375 0-55-24.624-55-55s24.625-55 55-55c30.376 0 55 24.624 55 55s-24.624 55-55 55zM230 250c-11.046 0-20-8.954-20-20s8.954-20 20-20 20 8.954 20 20-8.954 20-20 20zm79.351 144.217c-30.376 0-55-24.624-55-55s24.624-55 55-55c30.375 0 55 24.624 55 55s-24.624 55-55 55zm49.042-150.934c-30.375 0-55-24.625-55-55 0-30.376 24.625-55 55-55 30.376 0 55 24.624 55 55 0 30.375-24.625 55-55 55z';
const icons = {};
for (var i = 0; arrayUnicalGanres.length - 1; i++) {
  icons[arrayUnicalGanres[i]] = iconsKino.kino;
}

console.log(icons);

//const listItems = ['drama', 'comedia', 'action', 'kino', 'kino'];
const listItems = arrayUnicalGanres;

const iconTemplate = path => {
  return `
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
      <path d="${path}" />
    </svg>
  `;
};

console.log(iconTemplate);

const listItemTemplate = (text, translateValue) => {
  return `
    <li class="dropdown-list-item">
      <button class="dropdown-button list-button" data-translate-value="${translateValue}%">
        <span class="text-truncate">${text}</span>
      </button>
    </li>
  `;
};

const renderListItems = () => {
  dropdownList.innerHTML += listItems
    .map((item, index) => {
      return listItemTemplate(item, 100 * index);
    })
    .join('');
};

window.addEventListener('load', () => {
  renderListItems();
});

const setDropdownProps = (deg, ht, opacity) => {
  root.style.setProperty('--rotate-arrow', deg !== 0 ? deg + 'deg' : 0);
  root.style.setProperty('--dropdown-height', ht !== 0 ? ht + 'rem' : 0);
  root.style.setProperty('--list-opacity', opacity);
};

mainButton.addEventListener('click', () => {
  const listWrapperSizes = 3.5; // margins, paddings & borders
  const dropdownOpenHeight = 4.6 * listItems.length + listWrapperSizes;
  const currDropdownHeight =
    root.style.getPropertyValue('--dropdown-height') || '0';

  currDropdownHeight === '0'
    ? setDropdownProps(180, dropdownOpenHeight, 1)
    : setDropdownProps(0, 0, 0);
});

dropdownList.addEventListener('mouseover', e => {
  const translateValue = e.target.dataset.translateValue;
  root.style.setProperty('--translate-value', translateValue);
});

dropdownList.addEventListener('click', e => {
  const clickedItemText = e.target.innerText.toLowerCase().trim();
  const clickedItemIcon = icons[clickedItemText];

  dropdownTitleIcon.innerHTML = iconTemplate(clickedItemIcon);
  dropdownTitle.innerHTML = clickedItemText;
  setDropdownProps(0, 0, 0);
});

dropdownList.addEventListener('mousemove', e => {
  const iconSize = root.style.getPropertyValue('--floating-icon-size') || 0;
  const x = e.clientX - dropdownList.getBoundingClientRect().x;
  const y = e.clientY - dropdownList.getBoundingClientRect().y;
  const targetText = e.target.innerText.toLowerCase().trim();
  const hoverItemText = icons[targetText];

  floatingIcon.innerHTML = iconTemplate(hoverItemText);
  root.style.setProperty('--floating-icon-left', x - iconSize / 2 + 'px');
  root.style.setProperty('--floating-icon-top', y - iconSize / 2 + 'px');
});
